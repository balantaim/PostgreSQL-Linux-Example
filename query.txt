--Install postgresql for Ubuntu
sudo apt install postgresql postgresql-contrib
--Run it from the terminal (postgres is super user)
sudo -u postgres psql

----------------------------------------------

CREATE DATABASE toolsdelivery;

--Connect to the DB(DBName)
\c toolsdelivery
--Show the tables
\dt

--Create autogenerated ID with SMALLSERIAL = 1 to 32,767, SERIAL = 1 to 2,147,483,647, BIGSERIAL =...

--Create table Cities
CREATE TABLE Cities
(
id SERIAL PRIMARY KEY, 
name varchar(20) NOT NULL, 
country_id integer NOT NULL
);

--Check the the table information
SELECT * FROM Cities;

--Create Table Customers
CREATE TABLE Customers
(
id SERIAL PRIMARY KEY, 
name varchar(20) NOT NULL, 
city_id integer NOT NULL
);

--Constraint
ALTER TABLE Customers ADD CONSTRAINT Cities FOREIGN KEY (city_id) REFERENCES Cities(id);

--Create table Countries
CREATE TABLE Countries
(
id SMALLSERIAL PRIMARY KEY, 
name varchar(20) NOT NULL, 
city_id integer NOT NULL
);

ALTER TABLE Countries ADD CONSTRAINT Cities FOREIGN KEY (city_id) REFERENCES Countries(id);

--Create table Employees
CREATE TABLE Employees
(
id SERIAL PRIMARY KEY, 
city_id integer NOT NULL, 
first_name varchar(12) NOT NULL,
last_name varchar(12) NOT NULL, 
dob date NOT NULL, 
chief_id integer NOT NULL
);

ALTER TABLE Employees ADD CONSTRAINT Cities FOREIGN KEY (city_id) REFERENCES Cities(id);

--Create table Products
CREATE TABLE Products
(
id SMALLSERIAL PRIMARY KEY, 
name varchar(20) NOT NULL, 
current_price money NOT NULL, 
country_id integer NOT NULL, 
category_id integer NOT NULL
);

ALTER TABLE Products ADD CONSTRAINT Countries FOREIGN KEY (country_id) REFERENCES Countries(id);

--Create table Categories
CREATE TABLE Categories
(
id SMALLSERIAL PRIMARY KEY, 
name varchar(20) NOT NULL
);

ALTER TABLE Products ADD CONSTRAINT Products FOREIGN KEY (category_id) REFERENCES Categories(id);

--Create table Orders
CREATE TABLE Orders
(
id SERIAL PRIMARY KEY, 
employee_id integer NOT NULL, 
destination_city_id integer NOT NULL, 
order_date date NOT NULL, 
customer_id integer NOT NULL, 
product_id integer NOT NULL, 
historical_price money NOT NULL
);

ALTER TABLE Orders ADD CONSTRAINT Employees FOREIGN KEY (employee_id) REFERENCES Employees(id);

ALTER TABLE Orders ADD CONSTRAINT Cities FOREIGN KEY (destination_city_id) REFERENCES Cities(id);

ALTER TABLE Orders ADD CONSTRAINT Customers FOREIGN KEY (customer_id) REFERENCES Customers(id);

ALTER TABLE Orders ADD CONSTRAINT Products FOREIGN KEY (product_id) REFERENCES Products(id);

--Insert some data

INSERT INTO Cities(name, country_id) values('Paris', 10);
INSERT INTO Cities(name, country_id) values('Mexico city', 20);
INSERT INTO Cities(name, country_id) values('London', 40);

INSERT INTO Customers(name, city_id) values('Figaro', 1);
INSERT INTO Customers(name, city_id) values('Lee', 2);
INSERT INTO Customers(name, city_id) values('Jack', 3);

INSERT INTO Countries(name, city_id) values('France', 1);
INSERT INTO Countries(name, city_id) values('Mexico', 2);
INSERT INTO Countries(name, city_id) values('United Kingdom', 1);

INSERT INTO Employees(city_id, first_name, last_name, dob, chief_id) values(1, 'Martin', 'Atanasov', '1900-01-01', 100);
INSERT INTO Employees(city_id, first_name, last_name, dob, chief_id) values(2, 'Ivan', 'Ivanov', '2001-01-01', 200);
INSERT INTO Employees(city_id, first_name, last_name, dob, chief_id) values(3, 'Kiril', 'Petkov', '1999-01-01', 300);
INSERT INTO Employees(city_id, first_name, last_name, dob, chief_id) values(1, 'Krum', 'Strashni', '2002-11-11', 400);

INSERT INTO Categories(name) values('Boza');
INSERT INTO Categories(name) values('Alcohol');
INSERT INTO Categories(name) values('Cola');

INSERT INTO Products(name, current_price, country_id, category_id) values('Boza', 30, 1, 1);
INSERT INTO Products(name, current_price, country_id, category_id) values('Jack Daniels', 550, 2, 2);
INSERT INTO Products(name, current_price, country_id, category_id) values('Coca Cola', 20, 2, 3);

INSERT INTO Orders(employee_id, destination_city_id, order_date, customer_id, product_id, historical_price) values(1, 1, '2022-05-06', 1, 1, 100);
INSERT INTO Orders(employee_id, destination_city_id, order_date, customer_id, product_id, historical_price) values(2, 2, '2022-06-13', 2, 2, 200);
INSERT INTO Orders(employee_id, destination_city_id, order_date, customer_id, product_id, historical_price) values(2, 3, '2022-07-22', 3, 2, 250);


--Task 1: Show all the information about employee with ID 2
SELECT * FROM Employees WHERE id = 2;

--Task 2: Show first name and last name of all employees whose first name begins with letter M
SELECT first_name, last_name FROM Employees WHERE first_name LIKE 'M%';

--Task 3: Show the employes with ages greater than 21 
SELECT * FROM Employees WHERE age(dob) > '21 YEARS';

--Task 4: Show first_name, last_name and dob from Employees where first_name = 'Krum'
SELECT first_name, last_name, dob FROM Employees WHERE first_name LIKE '%Krum%';

